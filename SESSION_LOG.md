# Session Log

## Prior Summary
Wan2GP continues its migration into a headless, CLI-first workflow anchored by `ProductionManager.run_generation()`, which prepares adapters, metadata contexts, and notifier wiring before delegating to `wgp.generate_video`. Queue orchestration runs entirely under `cli/` with `QueueController` and the TCP control server mirroring the legacy UX while `cli.queue_state.QueueStateTracker` rebuilds deterministic telemetry. Media persistence now lives in `core/io/media.py`, where `MediaPersistenceContext` vends retry-aware `save_*` helpers that honour codec/container overrides; legacy `shared.utils.audio_video.save_*` shims have been retired. MatAnyOne preprocessing aligns with this stack, cloning metadata and media contexts so foreground/alpha/videos, RGBA archives, and audio tracks persist through the shared helpers, complete with manifest emission and queue/status audio telemetry guarded by new smoke tests. Prompt enhancer and LoRA adapters sit behind dedicated bridges, keeping activation state deterministic and severed from `wgp` globals. With these foundations, ongoing milestones focus on hardening CLI orchestration, pruning GUI-era utilities, and documenting manifest expectations for every entry point.

## 2025-11-02 (Session 15)
- `preprocessing/dwpose/pose.py`: Added `_ensure_numpy_sequence` to normalise frame inputs and refactored `save_one_video` to accept cloned `VideoSaveConfig` instances or a `MediaPersistenceContext`, propagating quality/macro-block overrides while routing persistence through shared logging/manifest hooks.
- `wgp.py`: Extended `preprocess_video_with_mask` with keyword-only persistence controls, emitting debug `masked_frames*.mp4` and `masks*.mp4` through `save_one_video` when requested. Updated guide preprocessing call sites to inject `MediaPersistenceContext`, cloned configs via `resolve_video_config`, and notifier loggers so debug outputs honour codec/container defaults.
- `docs/IO_MEDIA_MIGRATION.md`, `PROJECT_PLAN_LIVE.md`, `LIVE_CONTEXT.md`: Documented the dwpose persistence changes, marked the roadmap milestone complete, refreshed immediate next actions with regression coverage follow-up, and recorded the new context threading in the live context notes.
- Validation: `python -m py_compile preprocessing/dwpose/pose.py wgp.py`.
